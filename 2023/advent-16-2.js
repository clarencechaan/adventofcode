let input = `\\...\\..........|..\\........../...............................\\.\\.....................................-........
..........................--............/.....-.../............-........................\\./.\\|\\...............
...|.-\\.|.......|......../.....-........|........................\\......|..............\\......|...............
...-\\.....................\\......../....../..............................|........-.........\\...-\\....-.......
.........\\|............/-....-......-................\\....-........|./.........-..|....................|......
..-.....\\........................-.....-..../..............||.............-.................|..........-.-././
......................-\\......................................-/......||.........-.-......./..................
|..\\................|.....\\.............\\.......|........-..................\\|.................|...-..........
............................|.....|.......\\../..........\\......\\../..|..../........-..\\.-......-..............
\\....-.....................\\....../............-/..|.........../-.........|.../................\\.......|\\...//
.......-.-........../........-.........\\..../......................|.............|.....\\....|......../........
.../......../.........|.....-.............|.....\\\\-.|..\\..........\\..|...............-.|...........-......-../
............./.............../......./.................-.................|/...||............|.............|\\..
...................-..................................../.\\..................|..........|........|...../..|./.
.........................|......\\..../...........|..-......|..-.-../..\\.......\\............................|..
.........\\..|...............//.........|................|................................./..-..-.............
......||...........|...|../.............../....-......|..\\.....-..........\\..................\\.........../....
............../-......|.................-......|........-...--................./.............|..........\\.....
......\\.|./...........\\...................\\..-.........-.....-.-.......|./....................../.|..\\|.......
./...........\\..|...................../....................................\\../.................\\...........\\.
..............|............................./...\\.............../.....-.........\\./..-.../\\\\..................
\\./|......\\............|.........................|....-../.......\\........./.............../-........../....\\.
....-................................\\....................../.|...|.................-...|.......--............
.......-....\\/../.................-/...-./...-...........................-.............\\...........|..........
................................................\\........./............../.....|.......\\......|........\\./....
..........-..../......-.............|...-.....\\..-......................-..\\.....|....../....\\./.....|........
.......-...../..................-....../........./......./..............|......-....|....|.\\....|......-./-...
......\\/.....................|.-.........-.....\\.....................-.-....|.................|.-\\./..........
............\\...........-................|....|....|-......\\..|/............\\........-...-..........-....\\....
...\\............-...........|.............|...............-......|.............\\..\\................\\..........
...........................|..........|..................\\..\\........|...../......|....|..........-...........
.......-.../..................-...\\\\.....\\..-.....|/..................................-.........../...........
/......\\.\\........................../|........................-........-..................-..............-.|..
../............|\\......|....|.........................../....-..\\.............../.............-........|......
........./.........|\\........................|.\\....................|\\........................|....../........
.../..........|......../....-......../.................\\................-...\\............/...........-....|...
...................../...../../..-........\\/............-./..|................../.............................
............./.......\\..-/.........\\..../..................|.\\...\\...-..-.-............\\..../....|........|\\..
...../........|..............\\..|.|...|.-......-....\\.......................-.\\.......\\...........|...........
..............\\..|................................/-.....-...|.............\\..//..\\......|...............|....
...............................-......|\\............../.\\.\\............./......\\..............................
............|/...\\.....|.......|..\\....................\\.../..................................................
|........../......../............\\../...\\...\\.....-........|../................\\-.............../.........\\...
.....|...-...................../..-...................\\........|./.......-...\\-.../....|.................|....
...........-..................................\\.......\\....../..............................|.................
........./.\\................\\...-.|........./......\\................-.../........|...\\.....\\.....|............
.-....../......./....-...................\\.............-....................|.-.\\./........................\\..
........./...../..........................-...............\\........-....................................\\.....
\\..|...........................\\/...-................................................./.......-..\\....\\.......
....-.|/../...../......./....................-..........-......-.........\\.........../...................\\....
.................................../.........|...........................\\.....-..../.........................
............/..../.../......\\........................-.......|............-........./|........-...............
../......../..........-.........................................................-.........\\..-|...............
...../../...................|.................|.........................................../......./..........\\
...|..........||......................./......./...-..|..\\/......./................\\.\\........../...\\.........
..-.\\\\..|................|....-.......................................-......../.../............|.............
..............-../...............................-.......................\\....................|..........././.
...\\............/.................|.-.|............./......|......-./...............\\.\\.................-.....
.............|.............\\......|.................-|...|.........|.....-......../.......|...................
...\\-............-..-................/.............-.......\\............\\.........-|...\\.............|........
..........|.....\\...../...\\....../|.|.|......../-....--....\\........|...........|..........\\..................
...............\\......./.....|............................|./.............-.|.......\\.-............\\.......|..
....-..........................|\\....................................................................-........
............\\........|...../\\/-........|./.......|..-........................../../.......-..........-........
-..\\............\\..\\.../.......\\.........\\..............\\....../...........-.......\\....................|.....
........|..........|.............|.............-..|..................|....-\\.././......|.............|........
..../......................../|..|......................|..............................|...................-..
.......-/.../........-........................\\....-./.-...........|........./....\\...........-...../.........
........./-\\........../.................-.......\\...................-...\\.......\\.-...........\\...............
.........................\\.../..........................||..|.|...............................................
...................-........./..../........................\\................-.....................|...........
...................................|.....\\...........|.........\\.../.-.-.......-....-....\\.............//.|.|.
..../............|-.......././.........-............\\.....-......-................-......\\........\\.........-.
.\\......................\\.|...\\.-........\\..............-..................-.........................../.../..
..............|..\\../...............\\|..........\\./...................\\...........|...........................
....|......\\.-\\.................-..................../........\\....-...../.............-.\\.|..................
......................-.|..|........................\\...............-..\\..-..../....../...........|...\\.......
...........|......\\................../....-...\\|................\\......../|........................|.........-
...........-.............-...-................\\...-.......|.........../........-..............................
............|................|....--.........../-.....|......\\.............../.........../...|................
-.....\\............/....../.......|.........../...............................-.....//.................-......
-..............|...........-..........|..-|-...-...........................................\\...........|......
...../......|........-...\\.................-......|.......-.......................|..................././..-..
\\..........................................\\...-..\\......./......-.......\\.....|..\\....\\.../.\\..........|...\\.
............./.........-............../....|..../...-....|...-........\\............\\...................|......
/.......|-..../..\\.....\\..............................\\............|..............-.....|..../............-...
............\\................................................/......\\..............\\.|........................
\\/..../.........|\\.....|.../....................../.../..-............-..........-.../.-..../.................
.......|-..|...................../................\\..............\\............/........../\\...|..../..........
........................................................................\\............/.....-.\\.-..............
.......................\\.........../........\\......./.........|.............\\..|....................-.........
.|.../-.......-.....\\...................|.........||..\\...|.-....|....\\..............\\.......-.|.......\\/.....
........../.|.........|............../........\\...........|.-..................\\.\\-..........\\...-............
....\\./..........\\.........\\../......||........\\..\\......-..........................................\\....\\....
|...........\\.............../.....|............|..............\\...............-............|....\\.....-.......
.||................................|..|..\\../...-........................\\..................\\.......|.........
....................-.....\\..........................-|--|../.\\............................||......../........
........|..../........................|........\\....-...|.../.............|.../../....\\..-..............-.....
.......\\...\\......-...-.....................|....\\............-...|.-....\\.....-......-.......................
..-......./...................../..../..........-\\......./..-./.................\\.\\..............|............
....../............../................\\.........-......./..................................././...|...........
......|-..................|-....|...../.|....................-............................\\...................
...........|.......................................|....\\........./......./../......................\\|........
..............|.\\........../.........................../......|.........................../............./../..
.........-......\\........\\........-..........|...|..............|........./....-........../.././......./......
............|.........\\.......\\.........|..............-......./.....|/....../......./....\\.........-\\........
.............-.../..................-.......\\...................-/......-.........|........................\\..
...............|.\\-|//..\\.|............................................/..../...........\\-....................
..........|......./...\\../|.............................................................................../...
...........................|.....--..................................-....\\...||-........./\\......-.....\\.\\...`;

let grid = input.split("\n").map((str) => str.split(""));
const n = grid.length;
const m = grid[0].length;

function getEnergized(startRow, startCol, startDir) {
  let beams = [];
  for (let i = 0; i < n; i++) {
    beams[i] = [];
    for (let j = 0; j < m; j++) beams[i][j] = new Set();
  }

  function markBeams(row = startRow, col = startCol, dir = startDir) {
    if (row < 0 || row >= n || col < 0 || col >= m || beams[row][col].has(dir))
      return;
    beams[row][col].add(dir);
    switch (grid[row][col]) {
      case ".":
        switch (dir) {
          case ">":
            markBeams(row, col + 1, dir);
            break;
          case "v":
            markBeams(row + 1, col, dir);
            break;
          case "<":
            markBeams(row, col - 1, dir);
            break;
          case "^":
            markBeams(row - 1, col, dir);
            break;
        }
        break;
      case "/":
        switch (dir) {
          case ">":
            markBeams(row - 1, col, "^");
            break;
          case "v":
            markBeams(row, col - 1, "<");
            break;
          case "<":
            markBeams(row + 1, col, "v");
            break;
          case "^":
            markBeams(row, col + 1, ">");
            break;
        }
        break;
      case "\\":
        switch (dir) {
          case ">":
            markBeams(row + 1, col, "v");
            break;
          case "v":
            markBeams(row, col + 1, ">");
            break;
          case "<":
            markBeams(row - 1, col, "^");
            break;
          case "^":
            markBeams(row, col - 1, "<");
            break;
        }
        break;
      case "|":
        switch (dir) {
          case ">":
            markBeams(row - 1, col, "^");
            markBeams(row + 1, col, "v");
            break;
          case "v":
            markBeams(row + 1, col, "v");
            break;
          case "<":
            markBeams(row - 1, col, "^");
            markBeams(row + 1, col, "v");
            break;
          case "^":
            markBeams(row - 1, col, "^");
            break;
        }
        break;
      case "-":
        switch (dir) {
          case ">":
            markBeams(row, col + 1, ">");
            break;
          case "v":
            markBeams(row, col - 1, "<");
            markBeams(row, col + 1, ">");
            break;
          case "<":
            markBeams(row, col - 1, "<");
            break;
          case "^":
            markBeams(row, col - 1, "<");
            markBeams(row, col + 1, ">");
            break;
        }
        break;
    }
  }

  markBeams();

  let energized = 0;
  for (let i = 0; i < n; i++)
    for (let j = 0; j < m; j++) if (beams[i][j].size) energized++;
  return energized;
}

let output = 0;
for (let col = 0; col < m; col++) {
  output = Math.max(output, getEnergized(0, col, "v"));
  output = Math.max(output, getEnergized(n - 1, col, "^"));
}
for (let row = 0; row < n; row++) {
  output = Math.max(output, getEnergized(row, 0, ">"));
  output = Math.max(output, getEnergized(row, m - 1, "<"));
}
console.log(output);
