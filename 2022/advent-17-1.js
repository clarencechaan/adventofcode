class Rock {
  constructor(rockType, y) {
    switch (rockType) {
      case 0:
        this.pattern = [["#", "#", "#", "#"]];
        break;
      case 1:
        this.pattern = [
          [".", "#", "."],
          ["#", "#", "#"],
          [".", "#", "."],
        ];
        break;
      case 2:
        this.pattern = [
          ["#", "#", "#"],
          [".", ".", "#"],
          [".", ".", "#"],
        ];
        break;
      case 3:
        this.pattern = [["#"], ["#"], ["#"], ["#"]];
        break;
      case 4:
        this.pattern = [
          ["#", "#"],
          ["#", "#"],
        ];
    }
    this.x = 3;
    this.y = y;
  }

  move(dir) {
    function isValid(x2, y2, pattern) {
      for (let i = 0; i < pattern.length; i++)
        for (let j = 0; j < pattern[i].length; j++) {
          if (pattern[i][j] === "#" && tower.grid[y2 + i][x2 + j] !== ".")
            return false;
        }
      return true;
    }
    let [x2, y2] = [this.x, this.y];
    switch (dir) {
      case "<":
        x2--;
        break;
      case ">":
        x2++;
        break;
      case "D":
        y2--;
    }
    let valid = isValid(x2, y2, this.pattern);
    if (valid) [this.x, this.y] = [x2, y2];
    return valid;
  }
}

class Tower {
  constructor() {
    this.windPattern =
      ">>><>><<<<><<<>>><><<<<>>>><<<><>><>>><<<><<>>><<<><<><>>><<<><<<<><>>>><<<<>><<>>>><<<>><<<<>>><<<>>>><<<<>>>><<<><>>>><>>><><<>>><<<<>><<>>>><<><<>><<<<><<<><<<>><<>>><<<>>>><<<<><<<>><<><<<>><>>><<>>><<<<>>><><<<<>><<<<>><>>>><><>>><<<<><<>>><<<<>><<<<>>>><<<>><<>><<<<>>>><<><<<<>>>><<<<>>><<<<>>><<<>>>><><>><>>>><<<>>>><<>><<>>>><<<<>><>>><><<<<>>>><<<<><<><><<<>>>><<<><<>>><<<<>>><<>>><>>>><><<<>>><><<<>>>><>>><<><>><<<>><<<<>><<<<>><>><<<<><>>>><>>><<<>><>><<<<>>><<>><<<><<<<>>><>>><>>><>>><<>>><<<<>><<<>><<<<>>><<>><<<>><>>><<<<>>>><<<<><<>>><<<>>>><<<>>><<<>><<<<>>><<><>><<>><<>>><<<>>><<<>>>><<<<>>>><<<<>>><<<<>><<<>>>><><<>>><>>>><<<<>>>><<<>>>><<<<><><>>><<><<<>>>><<<><<<<><<>><<<><<>>><<<<><<><<>><<<>>><<>>><<<>>>><<><<<<><<<>><>>>><<<<>>><<<><<<<>><<<>><<<<>><>><<<>>>><<<>><<>>>><<<<>>>><<>>><>>><>>>><<>>><<<>>><<<>>><<<><><<>>>><><<<>>>><<<<>>>><>><<>><<<>>><>>>><<>>>><><>><>>><<<><<<>>><<<<><<>><<<<>>><<<>><>>>><<<<>><<<<>>><<>>>><<<<>>><<<>>><<<><<<><<>><><<><<<<>>><<<>>>><<<<><<<>>><><<<<>>>><<<>>>><<<><<<>>>><<<<>>>><<<>>>><<<>>><>><<>>>><<<<>><<>><<<<>>>><<><<<<>><<<<>><<<>>>><<<><<<>>><<>>><<<<>><>>><>>>><>><>>>><<><<>><<<<>>><<>><>><>><<<>><<>>>><<>>><>>>><>>><>>>><>>><<<>>><<<<><><<<>>><<<>>><<<>>>><<><<>>><>>><>>><>>><<<<>><<<<>>><<>>><<>><>>><<>>>><<>>><<>>><<>><>>>><<><<>>><<<>><<<<>>>><<><<>>>><<<>><<<><<<<>>>><<<<><><<>>><>>><<<>><>><>><<<<>>><>>><>>>><<<<>>>><><<<><<<><>>>><<<>>><>><<<<>><<<>>><<<<>><<<><<<>>><<>><>>>><>>><<<<>>>><><<><<>>><<<<>><<<<><>>>><<<>>><<<<>><<<><><<<<>><<<<>>><>>>><>>>><<>>><<<<>><<<>><<<><<>><<<>>><<><<<<><<<<>>><<<<>>>><<>>><>>><<><<>>>><<>>><>>>><<<><<>>>><<<>>><<>>><<>><<<<>>><><>>>><<<>>>><<<<>>><<<>>><>><>>>><>><>><<<<>><<<>>><<<<>>>><<>><><<<>>><<<<>><>>><>>><><<>><<<>>><>>>><>>>><<><<<>><>><<<<>>>><<<<>><<>>><<>>>><>><<<<>><><<>>><<<>><<<<><<>>>><<<><>>>><<<>><<<><<<>>><<>><<>><<<>>>><<<<>>><<<<><<<>><<<<><<>><<<<>><<<><>><<>>>><<>><<<<>><<>>><>><<>><<>>>><<><<<>><<<<><<<<>>><<<>>>><>>><<<>>><><<<>><<<<>>><<<<><<<>>>><<><<<><<>>>><>>><<>><<<<>>><>><<<<>><><>>>><>><<>><<<>>><<<>>>><><<>>>><<>>>><<<<>><>><<<>><<<><<<<><<>>><><<<<>>><>>>><<<>>><<<<>>><>>>><><<<<>>><><<<<>><<<><<<>>><<<>><<>>><>><<>>>><>><<>><<<<>><<>>>><<>>><<<>><>>><<><<<<>><<<>><>>><<<<><>><<<<>><><<<<>><<<>>>><<<<>><<<<>>><<<<><<>><<><<<<><><<>>><>>>><<<<>>><<>>>><<>><><>>><<<<>>><><>>><<<>><<>><<>><<<<>>>><<<>>><<<>><>>><<<<>><<><>>>><<<>>>><<<>>><>>>><<<<><>>>><>><<<<>><<<>><<>>><<><<>>><<>>><<<>>><>>><<<>>><<><<><>>>><<<>><<<<>>><>><<>><<<>>>><>>><<<<>><>>>><<<<>><<<>><<<>>>><><<>>><<>><<>><<>>><>><<<><<<<>><>>><<>><<<>><>>>><<<<>><<<>>><<<<>>>><<<>><<<<>>>><>><>><<<<><<<<>>>><<>><>><<<<>>><<>>><<<>>><<>>>><<<>>>><>>><>><<<>>><><<<>><>>><<<><>><<<>><<<><<<<>>><<><<<>>>><<<<><<>>><<<<>><><<<><<>><<<<>>>><<<<>><<<<>><<>>>><<>><<<<><<<>>><<>>><<<<>>>><<><><<<>>><<>><>>><<<<>>><<<>>><><<<<><<>><<<><<>><<<<>>><<>>><<<<>>>><<<<><<>><<>>><>>><<<<><<<<>><<>>>><><><<>>>><>>><>><<<<>>>><<<<>><<<<>>>><<<<>>>><<<<><<<>>>><>><<>>>><>>>><>>><<<><><>>>><<>>>><<<>>>><<>>>><<<>><<<>>>><<<<>><<>>><>><<<<>>>><<<><<>>><<><<<<>>><<>>><<<>>><<<<>>>><<<<>>>><<>>>><<<>>>><>><<<<>>><<<<><<<<>>><<<<>><<<<><><<<<>>><<>>><<<>><<<>>>><<<<>><<>>><<<>>><<<<>>>><>><<<<><<<<>>>><<<<>><<<>>><<<<>>>><<>>><>><><<>>><<<>>>><<<<>><<><<<>>>><>>>><<><<<>><<<>><<<>>><<<<>>>><>><<><<<<>>>><<<<>>>><>><<<<>><<>><<>><<<><<<<>><<><<<><<>><><<<>>><<<<><>><>><><<<>>><<>>><><<<>><>>>><>>>><>><>><>><>>>><<<<>>><>>>><>>>><<>>>><<<<>>><<><<<>>>><<<>>>><<<<>><<<<>><<><<>><>>>><<<>>>><<<>>><>><<>>>><<>><<>>><>>>><<>>><>>><<<>><>><<<>>>><<<<>>>><<<>><<<<>>><<<<>>><>>>><<>>><<>>><<>>><>>>><<<<>>><<>><>>>><>>><<<<>>><<>>><>>><<<<>><<><>>><<><<<<>>>><<<<><<>>>><<<<>>><>><<<>>>><<>><<<<><<<<>>><>>>><<<<>>>><<<<>><>><>>>><<<<><<<<>>><<>><<<<>>>><<<><>>>><<<<><<>>>><<<<>>><<<<><><<<<>>><><<<>><>>><<<<>><<><<<<>><>>><<<<>>>><<<<>><<><<>>><<<<>>><<>><<<<>><>>><<>>>><>><>><<<<>><<<>><<<>><<>>><>><<>>><>>>><<>><>><<<<>>><<<><<<><><<<<>>><<<>><<<<><<>><<<>><<<<><>>>><<><<<>><><<<>>><<<>>><<<<>>><<<<><><<><>>><><>><><>>>><<>>>><<><>>><<>>>><><>>>><<><<<<>>>><>>><<>>><<<><<<>>><<<<>>>><<<<><<>>>><>>><>>>><<<<><<<>><<<<>>>><<<>>>><<<<>>><<<<><<<><<<<><<<<>>><<<<>>><<<>>>><>>><<<>>>><<<>><<<<>>>><<<<>>><<<<><<<<>>><<>>>><<<><<<<><<<>>>><<<><<<<><<<<><>>>><><<<<>>>><<>>>><>><>>><<>>>><<<<><<<><>><<>>>><<<<>>><<><>>>><<<<>>><>>><<<<>>><>>><<<>>>><>>><<<<><<<<>><>>><>>>><>>>><<<><><>><<>>>><<<<><><<<<>>><<<><>><<>>>><<<<>>>><<<<>>>><<<<>><<>>><<<<>>>><<<<><<<>><>>>><>><<<><<<>>><>><<<<><<<<>><<>><<>><<>>>><>><<<<>>><<<<>>>><<<<><<><>>><<<<>>>><>><<<>>><><<>>><<<<>>>><>><<>><<<>><>><><<>>><<<<>>><<><<<<><<>>>><<<<>>>><<<>>>><><>>>><<><<<><<>>><<>>>><<<>>>><<<>><<<<>><>>><><<<<>>>><>>><<<<>>>><>><<>>><>>>><<<>>>><<><<>>><<<>>><<>><>><<>>>><<<<>><>><<<<>><<><<><<<<>>>><<<<><<<>><>>><<<<><>><<<><<>><><><<>>>><<<<>>><<<><<<<><<>>><<<>>><<>>>><>>>><<>>><<>>>><<<<>><<>>><>>><><<>><<<<>>><<<><<<>><<>><<<>>><>>><<<<>><<<<><>>><>><<>>><<<>>>><<<<>>><>>><>>><<>>>><<<>><<<>>><>><<>>>><<>><<<<>><>><>>><><<>>><<<>><<<>>><<>>><<<<>>>><<><<<<>>><>><<<<>>>><<<<><>>><<<<>>><<><<<<>><<<<>><<>>>><>>><<><>>>><<<<>>><<<><<<>>>><<>>>><<<<>>><>><<<<><<<<>>>><>><<<>><>>>><>>>><><<<>>><<>>><<>><<<<>>><<<><<<>><<<>><<<>><<<<>>>><>><<>>>><>><<<<>>><><<<<><<><>><<<<>>>><<<><>>>><<<<>>><<>>>><<<>>>><<<>><<>><<<><<<<>><<<>>>><<>><><<<>>>><<<>><<<<>><>>>><<<>><<>><<>><<<>>><<>>>><<>>><>><>>>><<<<>>><>>><<>>>><><<<>><<<<>>>><>>><><<<>><<<>>><<<<>>><>>>><><<>>>><<<><<<<>>><<<>><>>><><<>>><>>>><<><><<><<<<>>>><>><>><<>>><><<<<>>>><<<<>>><>>>><<>>><<<>><>><<>>>><<><>>>><<<<>>><<<>>><<<<><<<<><>><<<>><<<>>>><<<<>><<<<>>><>>><<><<<<>>><<<><<><<<>>><<<<>>>><<><<<<>>><>><<>>>><<><<<>>>><<><<<>><<<<><<<<>>><<<<>>>><<<<>><>>>><<<><<<>>>><<<>>>><<<>>><>><>><<<>><<><>>>><<<<>><<<>>><<<><><<>>>><>><>>><>>>><<<>>>><<>>>><<>>>><<><>>><<>>><<>>>><<>>><><<<<>>>><<<>>><<<<>><<>>><<<<>><>>><>>>><>><><<><<<<>>>><>><<<<>>><<><<>>>><<>>><<<<>>><<<<>>>><<<>>>><<>>><<>>><<<><>>><<<><<>><<>><<<<><<<><<<<><<<><<<<>>>><<<>><>><<>>>><<<<>>>><<>>>><>>><<>>><<>>>><<<>>>><<<<>>>><<>>><<>>>><<>><<><<<<>><<<<>>><<<<>>><<>>><<<<>>><<<>>>><<>><<>><<<>>><><<>>><><<<><<<>>>><<<>>>><<<>><<>><<>><<>>>><<<><<<<>>>><>><<<<>>><<<>>><>>><<>>><<>>>><<<>><<<<>><>><<<<><<>>><<<<>>>><<<<>><><>>>><>>>><><<<>>>><<<<>>><<<<>>>><<<<><<>>><<>>>><>>>><<<<>>><>>><<>>><<<><<>><>>>><<>><>>><>><>>><<<<><<<>>>><<>>>><>>><>>><>>>><<<><<<<>>><<<>>>><<<><>>><<<>><>><>><<<>><<<>>><<<>>>><>><><>>><<<><><<<<><<>><<<<>>><<<>><<<<>>><<<>>><<<<>>><<<>>><<<>>><<<>>>><<<<>>>><<<<><<<>>><<><<>>><<<<>>>><<>><<<<><>><<<<>><>><<<>>><<>>>><>><>>><<<>><<<><<<>><<<>><<<<>>><<<<>>><<<<>>><<<>>>><<<>><<<<>><<><<<>>><>>>><<>>><<<<><<>>><>>>><<<<>><<>>><<><>>><>>><<<<>>><<><<<><>>><<<>>><<>>><<<<><<><<<<>><<<<><<<>>><>><<>>>><<<>>>><<<<><<><<<<><<<<>>><>><<<><<>>>><<<<>>>><<<<>>><<<>>><<<>>><<<<><<<>>>><<<<>><<<>><<<<>><><>><>><><<<>><<<>>><>>>><<<>><<<<>><><>>>><<<<>>><<<<>>>><<<>><<<>>>><<<>>><<<>>><<<>><<>>>><><<<><<>>>><<<>><<>><<>>>><>>>><>>>><<>>>><<><<<>>>><<<>><<>>><<><<<<>>><<<<>><<<>><>><<<>>>><<<><<>>>><<<><<>><<>>><<<>>><<><>>><<<>>><<<>>><>>>><<<<><<<<>>><>>>><<<>>><<><<>><<<<>>>><<<<><<>>>><<<>>><<<><<>>>><<<<><>><<<>>>><<<<>>>><<><>>><<<>><<<>>>><<>>>><<>>>><<>>><<>><<>>><<<<><<<>>>><>><<<<>><><<>>><>><<<<><>><<>><><><>>><<>>>><>>>><<<<>><<<>>><<<<>>>><<<<>>><<<>>>><<>>><<>>><><>>>><<>><><<>>><<>>>><<<>>><<<<>>><<<>>><<>>><<<<>><<<<>><<<<>><<<>><<<<>>>><<<>>>><<<<><<<<>>>><>>><<<<>>>><<<>>><<<<><<<<><<><<<<>>>><>>>><>>><<<>>>><<><<<><<<<>><<<<>>><<>>>><<>><<<>>>><>>><>>>><>>><<>><<<>>>><<<>>><<>>>><>>><<<>>><<>><<>>><<<>>>><<>>>><<><<<>>><<><<<>><<<<><<<>><<><>><<<>>><<>>><<<>>><<<<><<<<><<<<><><>>>><<<>><>>><>>><<<>>>><>>><>><<<<>>><<<><<<>>>><>>><<<<><<<>>>><<<<>>>><<<><>><<<>><<<<>>><<<<>><<<<>><><<<<>>>><>>>><<>><<<<><<<><<<>>><<<>><<><<><>>><<<<>><<>>><<>>>><<<<><<<<><<<<>>><<>><<<<>>>><<<<>>>><<<>>>><<<<>><<<>><<<<>>>><<<<><<>><<<>>>><<><<<>><<<><<><<<<>>><>>>><<>>>><<<<>>>><<>><<<>>><>><<>>>><<<>>>><>>><<<<>>>><>>>><<>><><<<<>>><<>>><<>><<><>><<<>>>><>>>><>>>><><<<<>><<<>>><<<>>>><<<<><<<<>>>><<>>><<>>>><<>>>><><<><<>>><<><<>>><<><>>>><<>><<<>><<><<<<>>><<<>>>><<<<><>><<>>><<<>>>><<>>>><<>>>><<<>>>><<<<>>>><<>>>><<<><><>><>>><<<><<<>>>><><<<<>>>><<<<>>>><<>>><>>>><>>><<<<>>><<<>>><<<><>><<<<><<<<>>><>>>><>><<<>>><<<><<<<>>>><<>>><<<<><<<<><>><<<>>>><<<<>>><>>><<<<>><<>><<<<>>>><>>><<<<>><<<<><<><><<<<>><<<>><<<>><<<>><<<>>><><<>>>><<><<<<>><<<><<<<>>><<<<>><><>><>>>><<<<>>><<><<<>><<<><<>>><>><>><<<>>>><<>>>><>><<<<>><<<<><<<<>>><<<<>><<<>>>><<<<>>>><<><>>><<<>>><<>><<>><><<><<>>>><<<><<>>><<><<>>><<>>>><<<<>><<>>><<<>>><<<>>>><<><>>><<>>><>>><<<><<<><<>>>><<<<>>><<<<>>><<<>>><<<<>><><>>>><<<>>>><>><>>><<<>>><<<<>><>>>><>>><<<><<<><<<<><<<<>>><<<><<<><>>><<<<><<<<>><>><<>>><<<>>><<<<><<>>><<<>>>><>>>><<<>>><<<<>>><<<<><>>>><<>><<<><<<>>><<<><<<<>>>><<>><<<>><>><<<<>>><>>><<<<><><<<<>>><<>>>><<>><>>>><<<>><>>><<<>><<<<>>>><<<>><<<<><<>>><>>>><<>><<<<>>>><>><<>><<<<>>><<>>><>>>><><><><<<<>>><>>><>>>><<<>><<><<<><>><<<<>><>><<><<<>>>><><<<>>><<>>><<>><<<<><<<<><<<<>><<<>>>><><<>>>><<>>><<><<<>><<<>><<<<>>>><>>>><<<<>>><<<<>>><<<<>><>>>><<>>>><>><><<>>>><<<><><<<<>><<>><<><<<<>>><<>><>><<<>>>><<>><<>>>><<>>><<<<>>><<<<>>>><<<>>>><>>><>>>><<<<>>>><<<<><<<><<>>><<<>>><<><>>>><<><<<>>><<<<><<<>><<<<>><<>>><<><<<>>><>><>><<<>>><<>>>><><<>>><><<<>><<<<>>>><<>><><<<>>>><><<<<><<<>>>><<<<>><<>>>><>>>><<>><<<<><<<<>>><<>>>><<>>><<>>>><<<>>>><<>><<><>><<<>><<<>>><<>>><<<<>>><<>><<<>><<<<>><<<><<>>><<<<>>><<<><<<<>><<>><<<<>><<>><<>>><<<>>><<>>><<>><<<>><<<>>>><>>><>><<<<>>><<>>>><>>>><<<<>>>><>>><<<<>>><<<>>>><<<<>>>><<<>>><<>>>><<<>><>>>><<<<>><<<>><><><<<><>>>><<<>><><>>>><<<>>><<<<>>>><<>>>><<>><<>>><<<<>>>><<<><>>>><>><<>>><<<>>><<<<><<<>><<<<><<<>>><>>><<>>><<><>>><<>>>><><<>>>><>>>><<<<><<<><><<>><<<>><<><<<>><<><<>><<<<>>>><<<>><<<<>>><<<<>>>><<<>><<<><<<>>>><<<>>>><><><<><><>>><<<>>>><>>><<<>>><<<<>>><><<<>>>><>><>>><<><<><<>>>><<<<>>><<<<>>>><><><<>><<<<>>><<<<>>><<<<><<<>><<<>>><<<<>>><<>><<>>><<<<>><<<><<<<><<<>>><<>>><<<>>><>><";
    this.time = 0;
    this.rockType = 1;
    this.grid = ["+-------+".split("")];
    this.activeRock = new Rock(0, 4);
    this.rockCount = 0;
    for (let i = 0; i < 4; i++) this.addRow();
  }

  addRow() {
    this.grid.push("|.......|".split(""));
  }

  printGrid() {
    console.log(
      [...this.grid]
        .reverse()
        .map((row) => row.join(""))
        .join("\n")
    );
  }

  cycle() {
    let wind = this.windPattern[this.time];
    this.activeRock.move(wind);
    let valid = this.activeRock.move("D");
    this.time = (this.time + 1) % this.windPattern.length;
    if (!valid) {
      this.rockCount++;
      this.writeRockToTower();
      this.activeRock = new Rock(this.rockType, this.highestPoint + 4);
      this.rockType = (this.rockType + 1) % 5;
      while (this.highestPoint + 8 > this.grid.length) this.addRow();
      return false;
    }
    return true;
  }

  writeRockToTower() {
    let { x, y, pattern } = this.activeRock;
    for (let i = 0; i < pattern.length; i++)
      for (let j = 0; j < pattern[i].length; j++)
        if (pattern[i][j] === "#") this.grid[y + i][x + j] = "#";
  }

  get highestPoint() {
    for (let y = this.grid.length - 1; y >= 0; y--)
      for (let x = 1; x <= 7; x++) if (this.grid[y][x] !== ".") return y;
  }
}

let tower = new Tower();
while (tower.rockCount < 2022) tower.cycle();
tower.printGrid();
console.log(tower.highestPoint);
